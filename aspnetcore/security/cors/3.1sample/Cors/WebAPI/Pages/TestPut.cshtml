@page
@model WebAPI.TestPutModel
@{
    Layout = null;
}

<div class="text-center">
    <h1 class="display-4">CORS Test</h1>
</div>


<div>
    <span id='result'></span>
</div>

<div>
    <input type="button" value="Values"
           onclick="requestVal('https://cors1.azurewebsites.net/api/values')" />
</div>

<div>
    <input type="button" value="Echo"
           onclick="requestVal2('https://cors1.azurewebsites.net/echo')" />
</div>

<div>
    <input type="button" value="Echo2"
           onclick="requestVal2('https://cors1.azurewebsites.net/echo2')" />
</div>

<div>
    <input type="button" value="Index"
           onclick="requestVal2('https://cors1.azurewebsites.net/Index')" />
</div>

<div>
    <input type="button" value="PUT test"
           onclick="PutVal('https://cors1.azurewebsites.net/api/TodoItems/5')" />
</div>

<div>
    <input type="button" value="Delete test"
           onclick="DeleteVal('https://cors1.azurewebsites.net/api/TodoItems/5')" />
</div>

<div>
    <input type="button" value="GET API test"
           onclick="requestVal2('https://cors1.azurewebsites.net/api/TodoItems')" />
</div>

<script>
    function requestVal(uri) {
        const resultSpan = document.getElementById('result');

        fetch(uri)
            .then(response => response.json())
            .then(data => resultSpan.innerText = data)
            .catch(error => resultSpan.innerText = 'See F12 Console for error');
    }

    function requestVal2(uri) {
        const resultSpan = document.getElementById('result');

        fetch(uri)
            .then(response => {
                if (response.ok) {
                    response.text().then(text => {
                        resultSpan.innerText = text;
                    });
                }
                else {
                    resultSpan.innerText = response.status;
                }
            })
            .catch(error => resultSpan.innerText = 'See F12 Console for error');
    }

    function PutVal(uri) {
        const resultSpan = document.getElementById('result');

        fetch(uri,
            {
                method: "PUT",
                headers:
                {
                    "Content-Type": "x-my-custom-header"
                }

            }).then((response) => {
                resultSpan.innerText = response.status;
            });
    }

    function DeleteVal(uri) {
        const resultSpan = document.getElementById('result');

        fetch(uri,
            {
                method: "DELETE",
                headers:
                {
                    "Content-Type": "x-my-custom-header"
                }

            }).then((response) => {
                resultSpan.innerText = response.status;
            });
    }

</script>
